---
import Layout from '../layouts/Layout.astro';
import Welcome from '../components/Welcome.astro';
import { PrismaClient } from '@prisma/client';

export const prerender = false;

const prisma = new PrismaClient();
const req = Astro.request;

// Parse cookies to get logged in user email
const cookies = Object.fromEntries(
  (req.headers.get('cookie') ?? '').split('; ').map(c => c.split('=').map(decodeURIComponent))
);
const userEmail = cookies.user || null;

let user = null;
if (userEmail) {
  user = await prisma.user.findUnique({
    where: { email: userEmail },
    select: {
      email: true,
      firstName: true,
      profilePic: true,
    },
  });
}
---

<Layout>
  <Welcome user={user} />
</Layout>
